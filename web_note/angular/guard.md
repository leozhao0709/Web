# Angular Guard

## 0. Note

Note:

-   You can use `ng g g [guard]` to generate the `canActivate` guard.
-   Make sure after you have your guard, use it in your `router`.

## 1. `canActivate/canActivateChild` guard

```ts
@Injectable({
    providedIn: 'root'
})
export class AuthGuard implements CanActivate, CanActivateChild {
    constructor(private authService: AuthService) {}

    canActivate(
        next: ActivatedRouteSnapshot,
        state: RouterStateSnapshot
    ): Observable<boolean> | Promise<boolean> | boolean {
        return this.authService.isAuthenticated().then(authenticated => !!authenticated);
    }

    canActivateChild(
        childRoute: ActivatedRouteSnapshot,
        state: RouterStateSnapshot
    ): Observable<boolean> | Promise<boolean> | boolean {
        return this.canActivate(childRoute, state);
    }
}
```

## 2. `canDeactivate` guard

```ts
import { Injectable } from '@angular/core';
import { ActivatedRouteSnapshot, CanDeactivate, RouterStateSnapshot } from '@angular/router';
import { Observable } from 'rxjs';

export interface CanComponentDeactivate {
    canDeactivate: () => Observable<boolean> | Promise<boolean> | boolean;
}

@Injectable()
export class CanDeactivatedGuard implements CanDeactivate<CanComponentDeactivate> {
    canDeactivate(
        component: CanComponentDeactivate,
        currentRoute: ActivatedRouteSnapshot,
        currentState: RouterStateSnapshot
    ): Observable<boolean> | Promise<boolean> | boolean {
        return component.canDeactivate();
    }
}
```

Note:

-   `CanDeactivate` guard cannot generated by using angular cli. But in webstorm, we have a snippet(ngguard-candeactive) to trigger it.
-   After you have this file, you **must implements `CanComponentDeactivate` interface for the component** that you want to use can deactivated guard.
-   You also need to set it up in your router.
